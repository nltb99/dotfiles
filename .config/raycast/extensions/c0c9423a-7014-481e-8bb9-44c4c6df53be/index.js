"use strict";var $=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var ne=Object.prototype.hasOwnProperty;var ae=(e,t)=>{for(var i in t)$(e,i,{get:t[i],enumerable:!0})},ce=(e,t,i,p)=>{if(t&&typeof t=="object"||typeof t=="function")for(let c of oe(t))!ne.call(e,c)&&c!==i&&$(e,c,{get:()=>t[c],enumerable:!(p=ie(t,c))||p.enumerable});return e};var le=e=>ce($({},"__esModule",{value:!0}),e);var ge={};ae(ge,{default:()=>j});module.exports=le(ge);var s=require("@raycast/api"),Z=require("child_process");var pe=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],de=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],ue=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],me=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],E=(e,t,i)=>{let p=e;return typeof t=="string"||Array.isArray(t)?p=e.toLocaleString(t,i):(t===!0||i!==void 0)&&(p=e.toLocaleString(void 0,i)),p};function T(e,t){if(!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);t={bits:!1,binary:!1,space:!0,...t};let i=t.bits?t.binary?me:ue:t.binary?de:pe,p=t.space?" ":"";if(t.signed&&e===0)return` 0${p}${i[0]}`;let c=e<0,f=c?"-":t.signed?"+":"";c&&(e=-e);let o;if(t.minimumFractionDigits!==void 0&&(o={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(o={maximumFractionDigits:t.maximumFractionDigits,...o}),e<1){let C=E(e,t.locale,o);return f+C+p+i[0]}let d=Math.min(Math.floor(t.binary?Math.log(e)/Math.log(1024):Math.log10(e)/3),i.length-1);e/=(t.binary?1024:1e3)**d,o||(e=e.toPrecision(3));let P=E(Number(e),t.locale,o),S=i[d];return f+P+p+S}var y=require("react");var B=require("react"),fe=()=>{};function he(e,t){let i=(0,B.useRef)(fe);(0,B.useEffect)(()=>{i.current=e},[e]),(0,B.useEffect)(()=>{if(i.current(),(t??0)>0){let c=Math.max(t??0,1e3),f=setInterval(()=>i.current(),c);return()=>clearInterval(f)}},[t])}var D=he;var v=process.platform,A=v==="darwin",b=v==="win32";function U(){return b?'powershell "Get-Process | Select-Object Id,ProcessName,CPU,WorkingSet,Path | ForEach-Object { \\"$($_.Id) $($_.ProcessName) $($_.CPU) $($_.WorkingSet) $($_.Path)\\" }"':"ps -eo pid,ppid,pcpu,rss,comm"}function K(e,t=!1){return b?t?`taskkill /F /PID ${e}`:`taskkill /PID ${e}`:t?`sudo kill -9 ${e}`:`kill -9 ${e}`}function R(e){if(!e.trim())return null;if(b){let t=e.trim().split(/\s+/);if(t.length<4)return null;let[i,p,c,f,...o]=t,d=o.join(" ")||"";return{id:parseInt(i)||0,pid:0,cpu:parseFloat(c)||0,mem:parseInt(f)||0,path:d,processName:p||""}}else{let t=["","","","","",""],i=/(\d+)\s+(\d+)\s+(\d+[.|,]\d+)\s+(\d+)\s+(.*)/,[,p,c,f,o,d]=e.match(i)??t;if(!p)return null;let P=d.match(/[^/]*[^/]*$/i)?.[0]??"";return{id:parseInt(p),pid:parseInt(c),cpu:parseFloat(f),mem:parseInt(o),path:d,processName:P}}}function W(e){if(A){let t=e.includes(".prefPane"),i=e.includes(".app/");return t?"prefPane":i?"app":"binary"}else return b&&e.toLowerCase().endsWith(".exe")&&(e.toLowerCase().includes("program files")||e.toLowerCase().includes("applications"))?"app":"binary"}function _(e,t){return A?e.match(/(?<=\/)[^/]+(?=\.app\/)/)?.[0]:b?t.replace(/\.exe$/i,""):t}function Y(e){return A?e.type==="prefPane"?{fileIcon:e.path?.replace(/(.+\.prefPane)(.+)/,"$1")??""}:e.type==="app"||e.type==="aggregatedApp"?{fileIcon:e.path?.replace(/(.+\.app)(.+)/,"$1")??""}:"/System/Library/CoreServices/CoreTypes.bundle/Contents/Resources/ExecutableBinaryIcon.icns":b?e.type==="app"?{fileIcon:e.path}:"\u{1F5A5}\uFE0F":"\u2699\uFE0F"}function G(e){return A&&e?{title:"Failed to Force Kill Process",message:"Please ensure that touch ID/password prompt is enabled for sudo",helpUrl:"https://dev.to/siddhantkcode/enable-touch-id-authentication-for-sudo-on-macos-sonoma-14x-4d28"}:b&&e?{title:"Failed to Force Kill Process",message:"Administrative privileges may be required. Try running as administrator."}:{title:"Failed to Kill Process",message:"The process could not be terminated. It may have already exited or require elevated privileges."}}var H=require("child_process");async function O(){return new Promise((e,t)=>{let i=U();(0,H.exec)(i,(p,c)=>{if(p!=null){t(p);return}let f=c.split(`
`).map(o=>{let d=R(o);if(!d||!d.processName)return null;let P=W(d.path||""),S=P==="app"?_(d.path||"",d.processName||""):void 0;return{id:d.id||0,pid:d.pid||0,cpu:d.cpu||0,mem:d.mem||0,type:P,path:d.path||"",processName:d.processName||"",appName:S}}).filter(o=>o!==null&&o.processName!=="");e(f)})})}var m=require("react/jsx-runtime");function j(){let[e,t]=(0,y.useState)([]),[i,p]=(0,y.useState)([]),[c,f]=(0,y.useState)(""),o=(0,s.getPreferenceValues)(),d=o.shouldSearchInPaths,P=o.shouldSearchInPid,S=o.shouldPrioritizeAppsWhenFiltering,C=o.shouldShowPID,q=o.shouldShowPath,V=+o.refreshDuration,z=o.closeWindowAfterKill,F=o.clearSearchBarAfterKill,X=o.goToRootAfterKill,[L,Q]=(0,y.useState)(o.sortByMem?"memory":"cpu"),[w,J]=(0,y.useState)(o.aggregateApps),k=()=>{O().then(r=>{t(r)}).catch(r=>{console.error("Failed to fetch processes:",r),(0,s.showToast)({title:"Failed to fetch processes",style:s.Toast.Style.Failure,message:r instanceof Error?r.message:"Unknown error"})})};D(k,V),(0,y.useEffect)(()=>{let r=e;w&&(r=re(r)),r.sort((n,a)=>L==="memory"?n.mem>a.mem?-1:1:n.cpu>a.cpu?-1:1),p(r)},[e,L,w]);let ee=r=>Y(r),M=async(r,n=!1)=>{let a=r.processName==="-"?`process ${r.id}?`:r.processName;if(!await(0,s.confirmAlert)({title:`${n?"Force ":""}Kill ${a}?`,rememberUserChoice:!0})){(0,s.showToast)({title:`Cancelled Killing ${a}`,style:s.Toast.Style.Failure});return}let x=K(r.id,n);(0,Z.exec)(x,N=>{if(N){let g=G(n);n&&g.helpUrl?(0,s.confirmAlert)({title:g.title,message:g.message,primaryAction:{title:"Open Help",onAction:()=>(0,s.open)(g.helpUrl)}}):(0,s.showToast)({title:g.title,message:g.message,style:s.Toast.Style.Failure});return}(0,s.showToast)({title:`Killed ${a}`,style:s.Toast.Style.Success})}),t(i.filter(N=>N.id!==r.id)),z&&(0,s.closeMainWindow)(),X&&(0,s.popToRoot)({clearSearchBar:F}),F&&(0,s.clearSearchBar)({forceScrollToTop:!0})},te=r=>{let n=[];return r.type==="aggregatedApp"&&r.appName!=null&&n.push(r.appName),C&&n.push(r.id.toString()),q&&n.push(r.path),n.join(" - ")},re=r=>{let n=Array(),a=new Map;a.set(1,{process:{id:1},childNodes:[]});let x=Array();r.forEach(l=>{if(l.type==="app"){x.push(l.id);let h=a.get(l.id);h==null?(h={process:l,childNodes:[]},a.set(l.id,h)):h.process=l;let u=a.get(l.pid);if(u==null)u={process:void 0,childNodes:[h]},a.set(l.pid,u);else if(u.process==null)u.childNodes.push(h);else{let I;for(;u?.process!=null&&u.process.pid!==1&&(I=a.get(u.process.pid))!=null;)u=I;u?.childNodes.push(h)}u.process?.id!==1&&(u.childNodes=u.childNodes.concat(h.childNodes),h.childNodes=[])}else n.push(l)});let N=a.get(1)?.childNodes,g=Array();return N?.forEach(l=>{if(l.process==null)return;g.push(l.process.id);let h=l.childNodes.map(u=>u.process?.id).filter(u=>u!=null);g=g.concat(h),n.push({id:l.process.id,pid:l.process.pid,cpu:(l.childNodes?.reduce((u,I)=>u+(I.process?.cpu??0),0)??0)+l.process.cpu,mem:(l.childNodes?.reduce((u,I)=>u+(I.process?.mem??0),0)??0)+l.process.mem,type:"aggregatedApp",path:l.process.path,processName:l.process.processName,appName:l.process.path.match(/(?<=\/)[^/]+(?=\.app\/)/)?.[0]})}),n},se=i.length;return(0,m.jsx)(s.List,{isLoading:i.length===0,searchBarPlaceholder:"Filter by name",onSearchTextChange:r=>f(r),searchBarAccessory:(0,m.jsx)(s.List.Dropdown,{tooltip:"Filter",storeValue:!0,onChange:r=>Q(r),children:(0,m.jsxs)(s.List.Dropdown.Section,{title:"Sort By",children:[(0,m.jsx)(s.List.Dropdown.Item,{title:"CPU Usage",value:"cpu"}),(0,m.jsx)(s.List.Dropdown.Item,{title:"Memory Usage",value:"memory"})]})}),children:(0,m.jsx)(s.List.Section,{title:"Processes",subtitle:`${se} running`,children:i.filter(r=>{if(c==="")return!0;let n=r.processName.toLowerCase().includes(c.toLowerCase()),a=d&&r.path.toLowerCase().match(new RegExp(`.+${c}.*\\.[app|framework|prefpane]`,"ig"))!=null,x=P&&r.id.toString().includes(c),N=r.type==="aggregatedApp"&&r.appName?.toLowerCase().includes(c.toLowerCase());return n||a||x||N}).sort((r,n)=>{if(S){let a=["app","aggregatedApp"];if(a.includes(r.type)&&!a.includes(n.type))return-1;if(!a.includes(r.type)&&a.includes(n.type))return 1}return 0}).map((r,n)=>{let a=ee(r);return(0,m.jsx)(s.List.Item,{title:r.processName,subtitle:te(r),icon:a,accessories:[{text:`${r.cpu.toFixed(2)}%`,icon:{source:"cpu.svg",tintColor:s.Color.PrimaryText},tooltip:"% CPU"},{text:T(r.mem*1024),icon:{source:"memorychip.svg",tintColor:s.Color.PrimaryText},tooltip:"Memory"}],actions:(0,m.jsxs)(s.ActionPanel,{children:[(0,m.jsx)(s.Action,{title:"Kill",icon:s.Icon.XMarkCircle,onAction:()=>M(r)}),(0,m.jsx)(s.Action,{title:"Force Kill",icon:s.Icon.XMarkCircle,onAction:()=>M(r,!0)}),r.path==null?null:(0,m.jsx)(s.Action.CopyToClipboard,{title:"Copy Path",content:r.path}),(0,m.jsx)(s.Action,{title:"Reload",icon:s.Icon.ArrowClockwise,shortcut:{key:"r",modifiers:["cmd"]},onAction:()=>k()}),(0,m.jsx)(s.Action,{title:`${w?"Disable":"Enable"} Aggregating Apps`,icon:s.Icon.AppWindow,shortcut:{key:"tab",modifiers:["shift"]},onAction:()=>{J(!w),(0,s.showToast)({title:`${w?"Disabled":"Enabled"} aggregating apps`})}})]})},n)})})})}
